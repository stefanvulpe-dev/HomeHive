@page "/listed-estates"
@using HomeHive.UI.ViewModels.Estates
@using HomeHive.UI.Interfaces
@using HomeHive.UI.Components.Profile.ListedEstates
@inject IEstateDataService EstateService
@inject ILogger<ListedEstates> Logger
@layout ProfileLayout

<div class="profile-card col d-flex flex-column h-sm-100">
    <div class="card-header">
        <h2>Listed Properties</h2>
    </div>
    <div class="card-body">
        <div class="row">
            @if (Estates != null)
            {
                @foreach (var estate in Estates)
                {
                    <EstateCard Estate="@estate"></EstateCard>
                }
            }
            else
            {
                <div class="col-12">
                    <p class="text-center">You have no listed properties.</p>
                </div>
            }
        </div>
    </div>
</div>

@code {
    private List<EstateModel>? Estates { get; set; }

    protected override async Task OnInitializedAsync()
    {
        var result = await EstateService.GetAll();

        if (result is { IsSuccess: true })
        {
            if (result.Estates != null)
                Estates = result.Estates.Select(e => new EstateModel
                {
                    EstateCategory = e.EstateCategory,
                    EstateType = e.EstateType,
                    Name = e.Name,
                    Location = e.Location,
                    Price = e.Price.ToString(),
                    TotalArea = e.TotalArea,
                    Utilities = e.Utilities,
                    Description = e.Description
                }).ToList();
        }
        else
        {
            Logger.LogError($"Error getting estates: {result?.Message}");
        }
    }

}